import{d as J,P as Y,Q as F,r as w,c as $,o as ve,w as L,a as i,b as h,y as he,q as M,F as N,e as K,A as m,u as Q,t as S,k as fe,f as pe,h as ge,Y as me,B as b,n as j,T as we,j as r,z as I,l as Z,C as O}from"./index-BlmP_x2W.js";import{a as ye,b as X,o as be}from"./index-B9LpUvon.js";import{S as ke}from"./index-BIzckBi9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";var k=(d=>(d.SINGLE="single",d.MULTI="multi",d))(k||{}),f=(d=>(d.ARROW_UP="ArrowUp",d.ARROW_DOWN="ArrowDown",d.ENTER="Enter",d.ESCAPE="Escape",d.TAB="Tab",d))(f||{});const xe={key:0,class:"flex flex-wrap gap-1 pr-4"},Se=["data-testid"],Re=["data-testid","onClick"],$e={key:0,class:"flex items-center rounded-full bg-gray-200 px-2 py-1 text-xs whitespace-nowrap text-gray-600","data-testid":"hidden-count"},Me={key:1,class:"text-gray-400 select-none"},Ee={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},Ce={key:0,class:"border-b border-gray-200"},Oe={class:"bg-white p-2"},Ae=["placeholder","disabled","onKeydown"],Le={key:1,class:"border-b border-gray-200"},Ne=["checked","indeterminate"],Ie={class:"font-medium text-gray-700 select-none"},Te={class:"scrollbar-none max-h-50 overflow-y-auto"},De={class:"flex items-center justify-center"},Ve={key:0,class:"p-2"},Be=["data-index","data-testid","onClick","onMouseenter"],_e={key:0,class:"flex items-center"},We=["checked"],Ue={key:0,class:"px-4 py-2 text-gray-500"},Pe=J({name:"BaseMultiSelect",__name:"index",props:Y({options:{},placeholder:{default:"請選擇一個或多個項目"},searchable:{type:Boolean,default:!1},deletable:{type:Boolean,default:!1},searchInputPlaceholder:{default:"輸入關鍵字搜尋..."},maxVisible:{default:3},dropdownOptionStyle:{default:()=>({highlightedNotSelected:"bg-blue-200 text-gray-900",highlightedSelected:"bg-blue-600 text-white",selected:"bg-blue-500 text-white",hoverNotSelected:"hover:bg-gray-100",hoverSelected:"hover:bg-blue-700"})},mode:{default:k.MULTI},showSelectAll:{type:Boolean,default:!1},selectAllText:{default:"全選"},showCheckbox:{type:Boolean,default:!1},remote:{type:Boolean,default:!1},searchMs:{default:300},minSearchLength:{default:2}},{open:{type:Boolean,default:!1},openModifiers:{},modelValue:{default:()=>[]},modelModifiers:{},remoteSearching:{type:Boolean,default:!1},remoteSearchingModifiers:{}}),emits:Y(["search"],["update:open","update:modelValue","update:remoteSearching"]),setup(d,{emit:T}){const l=d,E=T,c=F(d,"open"),o=F(d,"modelValue"),s=F(d,"remoteSearching"),v=w(""),n=w(-1),R=w(!1),C=w(new Map),q=(e,t)=>{const a=e===n.value,u=x(t),y=l.dropdownOptionStyle;return[a&&!u&&y.highlightedNotSelected,a&&u&&y.highlightedSelected,u&&!a&&y.selected,!u&&!a&&y.hoverNotSelected,u&&!a&&y.hoverSelected].filter(Boolean)},ee=ye(async e=>{l.remote&&(e.length>=l.minSearchLength?(s.value=!0,E("search",e)):s.value=!1)},l.searchMs),x=e=>o.value.includes(e),D=async e=>{l.mode===k.SINGLE?(o.value=[e],oe()):o.value=x(e)?o.value.filter(t=>t!==e):[...o.value,e],await O(),c.value&&g.value?.focus()},z=e=>{o.value=l.mode===k.SINGLE?[]:o.value.filter(t=>t!==e)},te=e=>{const t=C.value.get(e);return t?t.label:e.toString()},p=$(()=>{if(l.remote)return v.value.trim()&&v.value.length>=l.minSearchLength?l.options:Array.from(C.value.values());if(!v.value)return l.options;const e=v.value.toLowerCase().trim();return l.options.filter(t=>t.label.toLowerCase().includes(e))}),W=$(()=>p.value.length>0),le=$(()=>l.mode===k.SINGLE?o.value.slice(0,1):l.maxVisible<=0?o.value.length:o.value.slice(0,l.maxVisible)),U=$(()=>l.mode===k.SINGLE?0:Math.max(0,o.value.length-l.maxVisible)),P=$(()=>p.value.length===0?!1:p.value.every(e=>x(e.value))),G=$(()=>{const e=p.value.filter(t=>x(t.value)).length;return e>0&&e<p.value.length}),H=()=>{if(P.value){const e=p.value.map(t=>t.value);o.value=o.value.filter(t=>!e.includes(t))}else{const e=p.value.filter(t=>!x(t.value)).map(t=>t.value);o.value=[...o.value,...e]}},g=w(null),V=w(null),B=w(null),_=w({top:0,left:0,width:0}),ae=$(()=>({top:`${_.value.top}px`,left:`${_.value.left}px`,width:`${_.value.width}px`,zIndex:c.value?1e3+Date.now()%1e3+Math.floor(Math.random()*100):1e3})),A=()=>{if(g.value){const e=g.value.getBoundingClientRect(),t=e.bottom+window.scrollY+4,a=e.left+window.scrollX;_.value={top:t,left:a,width:e.width}}},oe=()=>{c.value=!1,g.value?.blur()};X(window,"resize",A),X(window,"scroll",A),be(g,()=>{c.value&&(c.value=!1)},{ignore:[V]});const se=()=>{if(p.value.length>0){const e=p.value[0];x(e.value)||D(e.value)}g.value?.focus()},ne=e=>{const t=B.value===document.activeElement,a=g.value===document.activeElement;if(!c.value){(e.key===f.ARROW_DOWN||e.key===f.ENTER)&&(c.value=!0,e.preventDefault());return}t&&(e.key===f.ARROW_DOWN||e.key===f.ARROW_UP)&&g.value?.focus(),e.preventDefault();const u=p.value.length;if(u!==0){if(a&&(e.ctrlKey||e.metaKey)&&e.key==="a"){e.preventDefault(),e.stopPropagation(),l.showSelectAll&&l.mode===k.MULTI&&H();return}switch(e.key){case f.ARROW_DOWN:{R.value=!0,n.value=n.value===-1?0:(n.value+1)%u;break}case f.ARROW_UP:{R.value=!0,n.value=n.value===-1?u-1:(n.value-1+u)%u;break}case f.ENTER:{if(n.value!==-1){const y=p.value[n.value];D(y.value)}break}case f.ESCAPE:{c.value=!1;break}case f.TAB:{c.value=!1;break}}}},re=e=>{if([f.ARROW_DOWN,f.ARROW_UP,f.ENTER].includes(e.key)){if(e.preventDefault(),e.key===f.ENTER){const t=p.value[n.value];if(n.value!==-1&&t){D(t.value),g.value?.focus();return}}g.value?.focus()}},ue=async()=>{if(await O(),V.value&&n.value!==-1){const e=V.value.querySelector(`[data-index="${n.value}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}},ie=e=>{R.value||(n.value=e)},de=()=>{R.value=!1},ce=()=>{R.value||(n.value=-1)};return ve(()=>{A(),l.options.forEach(e=>{C.value.set(e.value,e)})}),L(o,async()=>{c.value&&(await O(),A())},{deep:!0}),L(c,async e=>{e?(A(),n.value=-1,R.value=!1,await O(),l.searchable?B.value?.focus():g.value?.focus()):(v.value="",n.value=-1,R.value=!1)}),L(v,async e=>{await O(),n.value=-1,l.remote&&ee(e.trim())}),L(()=>l.options,async e=>{n.value=-1,l.remote?(e.forEach(t=>{C.value.set(t.value,t)}),s.value=!1,await O(),B.value?.focus()):(C.value.clear(),e.forEach(t=>{C.value.set(t.value,t)}))},{deep:!0}),L(n,async e=>{e!==-1&&c.value&&ue()}),(e,t)=>(r(),i("div",{ref_key:"rootRef",ref:g,"data-testid":"multiselect-root",class:"relative w-full max-w-sm",tabindex:"0",onKeydown:ne},[h("div",{class:"min-h-10 cursor-pointer rounded-lg border border-gray-300 bg-white p-2 shadow-sm transition duration-150","data-testid":"multiselect-trigger",onClick:t[0]||(t[0]=a=>c.value=!c.value)},[o.value.length>0?(r(),i("div",xe,[(r(!0),i(N,null,K(le.value,a=>(r(),i("div",{key:a.toString(),class:"flex items-center rounded-full bg-blue-100 px-2 py-1 text-xs whitespace-nowrap text-blue-800","data-testid":`tag-${a}`},[m(e.$slots,"selected-tag",{data:{value:a}},()=>[I(S(te(a)),1)]),m(e.$slots,"remove-tag",{data:{value:a,onRemove:z}},()=>[l.deletable?(r(),i("button",{key:0,type:"button",class:"ml-1 text-blue-600 transition-colors hover:text-blue-900","data-testid":`tag-delete-${a}`,onClick:b(u=>z(a),["stop"])},[...t[7]||(t[7]=[h("svg",{class:"h-3 w-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Re)):M("",!0)])],8,Se))),128)),l.mode===Q(k).MULTI&&U.value>0?(r(),i("div",$e,[m(e.$slots,"hidden-tags-count",{data:{count:U.value}},()=>[I(" +"+S(U.value),1)])])):M("",!0)])):(r(),i("div",Me,S(d.placeholder),1)),h("div",Ee,[m(e.$slots,"dropdown-icon",{data:{isDropdownOpen:c.value}},()=>[(r(),i("svg",{class:j(["h-4 w-4 text-gray-400 transition-transform",{"rotate-180":c.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[...t[8]||(t[8]=[h("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])])]),(r(),he(we,{to:"body"},[c.value?(r(),i("div",{key:0,ref_key:"dropdownRef",ref:V,style:fe(ae.value),class:"absolute overflow-y-auto rounded-lg border border-gray-300 bg-white shadow-xl"},[l.searchable?(r(),i("div",Ce,[h("div",Oe,[pe(h("input",{ref_key:"searchInputElementRef",ref:B,"onUpdate:modelValue":t[1]||(t[1]=a=>v.value=a),type:"text",placeholder:l.searchInputPlaceholder,class:j(["w-full rounded-md border border-gray-300 px-3 py-1.5 text-sm placeholder:text-gray-400! focus:ring-0",[s.value?"cursor-not-allowed opacity-50":""]]),"data-testid":"search-input",disabled:s.value,onClick:t[2]||(t[2]=b(()=>{},["stop"])),onKeydown:[me(b(se,["prevent"]),["enter"]),re]},null,42,Ae),[[ge,v.value]])])])):M("",!0),l.showSelectAll&&l.mode===Q(k).MULTI&&!s.value&&W.value?(r(),i("div",Le,[h("div",{class:"flex cursor-pointer items-center bg-white px-4 py-2 transition-colors hover:bg-gray-100","data-testid":"select-all",onClick:b(H,["stop"])},[m(e.$slots,"select-all-checkbox",{data:{isAllSelected:P.value,isIndeterminate:G.value}},()=>[h("input",{type:"checkbox",checked:P.value,indeterminate:G.value,class:"mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",onClick:t[3]||(t[3]=b(()=>{},["stop"])),onChange:t[4]||(t[4]=b(()=>{},["stop"]))},null,40,Ne)]),h("span",Ie,S(l.selectAllText),1)])])):M("",!0),h("div",Te,[s.value?m(e.$slots,"is-remote-searching-loading",{key:0},()=>[h("div",De,[Z(ke,{color:"#e623dd"})])]):d.options.length===0&&!s.value?m(e.$slots,"no-options",{key:1},()=>[t[9]||(t[9]=h("div",{class:"px-4 py-2 text-gray-500"},"沒有可用的選項",-1))]):(r(),i(N,{key:2},[!s.value&&W.value?(r(),i("ul",Ve,[(r(!0),i(N,null,K(p.value,(a,u)=>(r(),i("li",{key:a.value.toString(),class:j(["cursor-pointer px-4 py-2 transition-colors",q(u,a.value)]),"data-index":u,"data-testid":`option-${a.value}`,onClick:b(y=>D(a.value),["stop"]),onMouseenter:y=>ie(u),onMouseleave:ce,onMousemove:de},[l.showCheckbox?(r(),i("div",_e,[m(e.$slots,"option-checkbox",{data:{option:a,index:u,isSelected:x(a.value),isHighlighted:u===n.value}},()=>[h("input",{type:"checkbox",checked:x(a.value),tabIndex:"-1",class:"mr-2 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500",onClick:t[5]||(t[5]=b(()=>{},["stop"])),onChange:t[6]||(t[6]=b(()=>{},["stop"]))},null,40,We)]),m(e.$slots,"option-label",{data:{option:a,index:u}},()=>[h("span",null,S(a.label),1)])])):m(e.$slots,"option-label",{key:1,data:{option:a,index:u}},()=>[I(S(a.label),1)])],42,Be))),128))])):M("",!0)],64)),m(e.$slots,"no-search-result",{},()=>[d.searchable&&!s.value&&!W.value?(r(),i("div",Ue,[l.remote?(r(),i(N,{key:0},[I(S(v.value.length<l.minSearchLength?`請輸入至少 ${l.minSearchLength} 個字元進行搜尋`:`找不到符合 "${v.value}" 的結果`),1)],64)):(r(),i(N,{key:1},[I(' 找不到符合 " '+S(v.value)+' " 的結果 ',1)],64))])):M("",!0)])])],4)):M("",!0)]))],544))}}),Fe={class:"w-full"},je={class:"flex items-center justify-center gap-4"},Ke=J({name:"DemoMultiSelect",__name:"MultiSelect",setup(d){const T=w([]),l=w([]),E=w(!1),c=async o=>{try{if(!o&&E.value)return;await new Promise(v=>setTimeout(v,500));const s=[{label:`${o} - Vue.js`,value:`${o}-vue`},{label:`${o} - React`,value:`${o}-react`},{label:`${o} - Angular`,value:`${o}-angular`}];l.value=s,console.log("搜尋結果:",s)}catch(s){console.error("搜尋失敗:",s),l.value=[]}finally{E.value=!1}};return(o,s)=>(r(),i("div",Fe,[s[2]||(s[2]=h("h1",{class:"text-center text-lg"},"MultiSelect 多選下拉",-1)),h("div",je,[Z(Pe,{modelValue:T.value,"onUpdate:modelValue":s[0]||(s[0]=v=>T.value=v),"remote-searching":E.value,"onUpdate:remoteSearching":s[1]||(s[1]=v=>E.value=v),options:l.value,searchable:!0,deletable:!0,"show-checkbox":!0,"show-select-all":!0,remote:!0,placeholder:"選擇您會的程式語言",onSearch:c},null,8,["modelValue","remote-searching","options"])])]))}});export{Ke as default};
