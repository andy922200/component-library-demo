import{d,c as x,r as T,w as F,a as U,b as v,e as p,g as E,h as R,u as h,i as I,F as V,f as J,A as H,s as K,t as A,k as m}from"./index-D0FIH5Mc.js";import"./index-D1ypBbsW.js";const q={1:"tap_pay"},y=e=>e!=="no_payment",k=e=>e.accept!=="0",z=(e,a,t)=>{const s=e.format("YYYY/MM/DD"),n=e.add(1,"day").format("YYYY/MM/DD");return d(`${s} ${t}`).isBefore(d(`${s} ${a}`))?{limitStart:d(`${s} ${a}`),limitEnd:d(`${n} ${t}`)}:{limitStart:d(`${s} ${a}`),limitEnd:d(`${s} ${t}`)}},G=({transfer:e,bookStartTime:a,isBookingRightNow:t,price:s})=>{const{accept:n,hour:i,startTime:o,endTime:l}=e??{},r=k(e),c=n!=="1",u=+i||0,D=o||"00:00",M=l||"24:00",N=d(a),f=d(),Y=s<=0,g=r&&!c&&N.diff(f,"minute")<=+u*60,{limitStart:B,limitEnd:L}=z(f,D,M),C=f.isBetween(B,L,"minute","[)"),P=[];return g&&P.push(`預約時間開始前 ${u} 小時不支援轉帳付款，請選擇其他付款方式`),C||P.push(`轉帳期間為${D}至${M}，請選擇其他付款方式`),{state:r&&C&&!g&&!t&&!Y,errMsg:P.join(`
`)}},w=y,Q=({orderDate:e,payment:a,price:t})=>{const s=w(a),n=d(),i=d(e).isBetween(n,n.add(b,"day"),"day","[]"),o=t<=0,l=[];return s||l.push("CreditCard is not active."),i||l.push(`CreditCard is only available for orders within ${b} days from today.`),{state:s&&i&&!o,errMsg:l.join(`
`)}},j=e=>e==="1",W=({linepay:e,price:a,cycleTimes:t,orderDate:s})=>{const n=j(e),i=a>1e4,o=a<=0,l=(t||0)<=1,r=d(),c=d(s).isBetween(r,r.add(1,"month"),"day","[]"),u=[];return n||u.push("LinePay is not active."),i&&u.push("LinePay is only available for orders under 10000."),l||u.push("LinePay is not available for recurring payments."),c||u.push("LinePay is only available for orders within the current month."),{state:n&&!o&&!i&&l&&c,errMsg:u.join(`
`)}},b=210,S=e=>e==="1",X=({jkopay:e,orderDate:a,price:t})=>{const s=S(e),n=d(),i=d(a).isBetween(n,n.add(b,"day"),"day","[]"),o=t<=0,l=[];return s||l.push("JKoPay is not active."),i||l.push(`JKoPay is only available for orders within ${b} days from today.`),{state:s&&i&&!o,errMsg:l.join(`
`)}},_=e=>e==="1",Z=({cvs:e,price:a,isBookingRightNow:t})=>{const s=_(e),n=a<30,i=[];return s||i.push("CvsPay is not active."),n&&i.push("CvsPay is only available for orders above 30."),{state:s&&!n&&!t,errMsg:i.join(`
`)}},$=e=>e==="1",ee=({applepay:e,price:a})=>{const t=$(e),s=a<=0,n=[];return t||n.push("ApplePay is not active."),{state:t&&!s,errMsg:n.join(`
`)}},O=e=>e==="1",te=(e,a=!1,t)=>{const s=O(e),n=[],i=t?t>0:!1;return s||n.push("Point payment is not available."),a||n.push("Point payment is only available for members."),{state:s&&a&&i,errMsg:n.join(`
`)}},se=[{text:"信用卡付款 Credit Card",value:"credit-card",isAvailable:e=>w(e.payment),isDisabled:e=>{const{orderDate:a}=e,t=y(e.payment);return!Q({orderDate:a,payment:e.payment,price:e.price}).state||!t}},{text:"銀行轉帳 Transfer",value:"TRANSFER",isAvailable:e=>k(e.transfer),isDisabled:e=>{const{transfer:a,bookStartTime:t,isBookingRightNow:s}=e,n=y(e.payment);return!G({transfer:a,bookStartTime:t,isBookingRightNow:s,price:e.price}).state||!n}},{text:"LINE Pay",value:"LINEPAY",isAvailable:e=>j(e.linepay),isDisabled:e=>{const{linepay:a,price:t,cycleTimes:s,orderDate:n}=e,i=y(e.payment);return!W({linepay:a,price:t,cycleTimes:s,orderDate:n}).state||!i}},{text:"街口支付 JKOPAY",value:"JKPAY",isAvailable:e=>S(e.jkopay),isDisabled:e=>{const{jkopay:a,orderDate:t}=e,s=y(e.payment);return!X({jkopay:a,orderDate:t,price:e.price}).state||!s}},{text:"超商代碼付款 CVS",value:"CVS",isAvailable:e=>_(e.cvs),isDisabled:e=>{const{cvs:a,price:t,isBookingRightNow:s}=e,n=y(e.payment);return!Z({cvs:a,price:t,isBookingRightNow:s}).state||!n}},{text:"Apple Pay",value:"APPLEPAY",isAvailable:e=>$(e.applepay),isDisabled:e=>{const{applepay:a}=e,t=y(e.payment);return!ee({applepay:a,price:e.price}).state||!t}},{text:"點數付款 Point",value:"POINT",isAvailable:e=>O(e.point_enabled),isDisabled:e=>{const{point_enabled:a,hasMemberData:t,payment:s}=e,n=y(s);return!te(a,t,e.point).state||!n}},{text:"優惠代碼付款 Coupon",value:"COUPON",isAvailable:e=>!(e.price<0),isDisabled:()=>!1},{text:"免費 Free",value:"FREE",isAvailable:e=>e.price<=0,isDisabled:()=>!1}];function ae(e){const a=x(()=>se.filter(s=>s.isAvailable(e.value)).map(s=>{const n=s.value==="credit-card"?e.value.payment:s.value;return{text:s.text,value:n,disabled:s.isDisabled(e.value)}})),t=T(null);return F(a,s=>{const n=s.filter(o=>!o.disabled);if(n.length===0){t.value=null;return}n.some(o=>o.value===t.value)||(t.value=n[0].value)},{immediate:!0,deep:!0}),{paymentOptions:a,selectedPaymentType:t}}const ne={class:"w-full"},ie={class:"flex flex-wrap justify-center space-y-2"},re={class:"flex w-full justify-center"},oe=["value","disabled"],le={key:0},ce={class:"mx-2"},de={class:"mx-2"},pe={class:"flex w-full justify-center space-x-2"},ve=U({name:"DemoPaymentStrategies",__name:"PaymentStrategies",setup(e){const a=d(),t=T({priceAfterCoupon:100,point:0,orderDate:a.format("YYYY-MM-DD"),bookingStartTime:a.add(4,"day").format("HH:mm"),isBookingRightNow:!1,cycleTimes:1,payment:q[1],transfer:{accept:"1",hour:"2",startTime:"00:00",endTime:"24:00"},linepay:"1",jkopay:"1",cvs:"1",applepay:"1",point_enabled:"1"}),s=x(()=>({price:t.value.priceAfterCoupon,point:t.value.point,orderDate:t.value.orderDate,bookStartTime:t.value.bookingStartTime,isBookingRightNow:t.value.isBookingRightNow,cycleTimes:t.value.cycleTimes,payment:t.value.payment,transfer:t.value.transfer,linepay:t.value.linepay,jkopay:t.value.jkopay,cvs:t.value.cvs,applepay:t.value.applepay,point_enabled:t.value.point_enabled,hasMemberData:!0})),{paymentOptions:n,selectedPaymentType:i}=ae(s),o=l=>{t.value.priceAfterCoupon=l};return(l,r)=>(m(),v("div",ne,[r[4]||(r[4]=p("h1",{class:"mb-2 text-center text-lg"},"Payment Strategies 付款方式選擇",-1)),p("div",ie,[p("div",re,[E(p("select",{"onUpdate:modelValue":r[0]||(r[0]=c=>I(i)?i.value=c:null),class:"mx-auto"},[(m(!0),v(V,null,J(h(n),c=>(m(),v("option",{key:c.value,value:c.value,disabled:c.disabled},[H(A(c.text)+" ",1),c.disabled?(m(),v("span",le,"(不可使用)")):K("",!0)],8,oe))),128))],512),[[R,h(i)]])]),p("p",ce,"當前選擇: "+A(h(i)),1),p("p",de,"目前價格: "+A(s.value.price),1),p("div",pe,[p("button",{class:"rounded border border-gray-300 p-2 hover:bg-slate-600 hover:text-white",onClick:r[1]||(r[1]=c=>o(0))}," 使用優惠券讓價格變為 0 元 "),p("button",{class:"rounded border border-gray-300 p-2 hover:bg-slate-600 hover:text-white",onClick:r[2]||(r[2]=c=>o(20))}," 使用優惠券讓價格變為 20 元 "),p("button",{class:"rounded border border-gray-300 p-2 hover:bg-slate-600 hover:text-white",onClick:r[3]||(r[3]=c=>o(500))}," 使用優惠券讓價格變為 500 元 ")])])]))}});export{ve as default};
