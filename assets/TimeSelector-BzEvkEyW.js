import{d as g,r as b,c as R,w as A,a as J,o as Q,b as x,e as t,t as d,F as N,f as C,u as w,g as j,v as q,i as B,h as V,j as X,k as E}from"./index-D0FIH5Mc.js";import"./index-D1ypBbsW.js";function G({dateStr:S,timeStr:n,dateFormat:y="YYYY-MM-DD",timeFormat:p="HH:mm"}){return g(`${S} ${n}`,`${y} ${p}`).startOf("second")}function z({startTime:S,endTime:n,date:y,slotStart:p,slotEnd:c,slotDate:m,dateFormat:a="YYYY-MM-DD",timeFormat:i="HH:mm"}){const h=g(`${y} ${S}`,`${a} ${i}`);let r=g(`${y} ${n}`,`${a} ${i}`);n==="00:00"&&r.isBefore(h)&&(r=r.add(1,"day"));const l=g(`${m} ${p}`,`${a} ${i}`);let s=g(`${m} ${c}`,`${a} ${i}`);return c==="00:00"&&s.isBefore(l)&&(s=s.add(1,"day")),h.isBefore(s)&&r.isAfter(l)}const Z=({isNow:S,targetDate:n,timeSector:y,nowDayjs:p,startTime:c})=>{if(S){const a=p.minute()%y;return p.subtract(a,"minute").second(0).startOf("second")}else return G({dateStr:n,timeStr:c})},F=({allTimeSlots:S,targetDate:n,startTimeDayjs:y,nextDayHintKey:p})=>{const c=[];let m=!1;for(const a of S){let i=G({dateStr:n,timeStr:a.slotStart});if(a.slotEnd==="00:00"&&(i=i.add(1,"day")),i.isSameOrAfter(y)){if(a.isOverlap){m=!0;break}c.push({originalObj:a,label:a.slotEnd==="00:00"?`00:00_${p}`:a.slotEnd,value:a.slotEnd})}}return{endTimeOptions:c,sameDayBreak:m}},ee=({startTimeDayjs:S,maxUsageHours:n,usedTimeSlots:y,timeSector:p,targetDate:c,nextDayHintKey:m,dateFormat:a="YYYY-MM-DD",timeFormat:i="HH:mm"})=>{const h=[],r=g(c).add(1,"day").format(`${a}`),l=y.filter(f=>f.date===r),s=S.add(n,"hour");let v=g(`${r} 00:00`,`${a} ${i}`);const $=l.length>0?l.reduce((f,_)=>{const O=G({dateStr:r,timeStr:_.startTime}),D=O.minute(Math.floor(O.minute()/p)*p).second(0);return D.isBefore(f)?D:f},g(`${r} 24:00`,`${a} ${i}`)):g(`${r} 24:00`,`${a} ${i}`),o=$.isBefore(s)?$:s;for(;v.isBefore(o);){const f=v.add(p,"minute");h.push({originalObj:{slotStart:v.format(`${i}`),slotEnd:f.format(`${i}`),date:r},label:`${f.format(`${i}`)}_${m}`,value:f.format(`${i}`)}),v=f}return h},te=({endTimeOptions:S,startTimeDayjs:n,minUsageHours:y,maxUsageHours:p,isNow:c=!1,nowDayjs:m,dateFormat:a="YYYY-MM-DD",timeFormat:i="HH:mm"})=>{const h=(r,l)=>{const v=r.diff(l,"minute")/60;return v>=y&&v<=p};return S.filter(r=>{let l=g(`${r.originalObj.date} ${r.value}`,`${a} ${i}`);return r.originalObj.slotEnd==="00:00"&&(l=l.add(1,"day")),h(l,c?m:n)})};function se({timeSlots:S,targetDate:n,startTime:y,usedTimeSlots:p,timeSector:c,options:m={}}){const{maxUsageHours:a=b(24),minUsageHours:i=b(0),generateCrossDay:h=b(!0),nextDayHintKey:r="next-day",dateFormat:l="YYYY-MM-DD",timeFormat:s="HH:mm",defaultOption:v={label:"please-select-end-time",value:""}}=m;return{endTimeOptions:R(()=>{const o=g(),f=y.value==="Now",_={originalObj:{slotStart:"",slotEnd:"",date:""},label:v.label,value:v.value,disabled:!0};if(!n.value||!y.value||g(n.value).isBefore(o,"day")||g(n.value).isAfter(o,"day")&&f)return[];const O=Z({isNow:f,targetDate:n.value,timeSector:c.value,nowDayjs:o,startTime:y.value}),{endTimeOptions:D,sameDayBreak:Y}=F({allTimeSlots:S.value,targetDate:n.value,startTimeDayjs:O,nextDayHintKey:r});if(h.value&&!Y){const U=ee({startTimeDayjs:O,maxUsageHours:a.value,usedTimeSlots:p.value,timeSector:c.value,targetDate:n.value,nextDayHintKey:r,dateFormat:l,timeFormat:s});D.push(...U)}const H=te({endTimeOptions:D,startTimeDayjs:O,minUsageHours:i.value,maxUsageHours:a.value,isNow:y.value==="Now",nowDayjs:o,dateFormat:l,timeFormat:s});return[_,...H]})}}function ae({timeSlots:S,targetDate:n,usedTimeSlots:y,timeSector:p,options:c={}}){const{isNowActive:m=b(!0),dateFormat:a="YYYY-MM-DD",timeFormat:i="HH:mm",defaultOption:h={label:"please-select-start-time",value:""}}=c;return{startTimeOptions:R(()=>{const l=g().format(a),s=g().second(0).startOf("second"),v={originalObj:{slotStart:"",slotEnd:"",date:""},label:h.label,value:h.value,isNow:!1,fullString:"",disabled:!0};if(!n.value||g(n.value).isBefore(s,"day"))return[];const $=S.value.filter(o=>n.value===l?g(`${n.value} ${o.slotStart}`,`${a} ${i}`).second(0).startOf("second").isSameOrAfter(s):!0).filter(o=>!o.isOverlap).map(o=>({originalObj:o,label:o.slotStart,value:o.slotStart,isNow:!1,fullString:`${o.date}_${o.slotStart}-${o.slotEnd}`}));if(m.value&&n.value===l){const o=s.format(i),f=s.minute(),_=s.add(p.value-f%p.value,"minute").second(0).startOf("second").format(i),O=y.value.some(({startTime:Y,endTime:H,date:U})=>U===l?z({startTime:Y,endTime:H,date:U,slotStart:o,slotEnd:_,slotDate:l}):!1),D=$.some(Y=>Y.value===o);!O&&!D&&$.unshift({label:"now",value:"Now",originalObj:{slotStart:o,slotEnd:_,date:l},isNow:!0,fullString:`${l}_${o}-${_}`})}return[v,...$]})}}function le({targetDate:S,timeSector:n,usedTimeSlots:y,options:p={}}){const{dateFormat:c="YYYY-MM-DD",timeFormat:m="HH:mm"}=p,a=b([]),i=()=>{const l=[];let s=g(`${S.value} 00:00`,`${c} ${m}`);const v=g(`${S.value} 24:00`,`${c} ${m}`);for(;s.isBefore(v);){const $=s.add(n.value,"minute");l.push({slotStart:s.format(m),slotEnd:$.format(m),isOverlap:!1,isPast:!1,date:S.value}),s=$}a.value=l,h()},h=()=>{const l=g();a.value.forEach(s=>{let v=!1;y.value.forEach(({startTime:o,endTime:f,date:_})=>{z({startTime:o,endTime:f,date:_,slotStart:s.slotStart,slotEnd:s.slotEnd,slotDate:S.value})&&(v=!0)}),s.isOverlap=v;let $=g(`${S.value} ${s.slotEnd}`,`${c} ${m}`);s.slotEnd==="00:00"&&($=$.add(1,"day")),s.isPast=$.isBefore(l)})},r=R(()=>a.value.filter(l=>!l.isOverlap&&!l.isPast));return{timeSlots:a,availableTimeSlots:r,generateTimeSlots:i,checkOverlaps:h}}function ne(S,n={}){const{timeSector:y=30,maxUsageHours:p=24,minUsageHours:c=.5,generateCrossDay:m=!0,isNowActive:a=!0,dateFormat:i="YYYY-MM-DD",timeFormat:h="HH:mm",externalRefs:r,defaultOptions:l={startTime:{label:"please-select-start-time",value:""},endTime:{label:"please-select-end-time",value:""}}}=n,s=r?.selectedDate??b(""),v=r?.selectedStartTime??b(""),$=r?.selectedEndDateTime??b(""),o=b(null),f=b(y),_=b(p),O=b(c),D=b(m),Y=b(a),H=b(S),{timeSlots:U,generateTimeSlots:I}=le({targetDate:s,timeSector:f,usedTimeSlots:H,options:{dateFormat:i,timeFormat:h}}),{startTimeOptions:P}=ae({timeSlots:U,targetDate:s,usedTimeSlots:H,timeSector:f,options:{isNowActive:Y,dateFormat:i,timeFormat:h,defaultOption:l.startTime}}),{endTimeOptions:L}=se({timeSlots:U,targetDate:s,startTime:v,usedTimeSlots:H,timeSector:f,options:{maxUsageHours:_,minUsageHours:O,generateCrossDay:D,nextDayHintKey:"next-day",dateFormat:i,timeFormat:h,defaultOption:l.endTime}});return A([s,f],()=>{I(),v.value="",o.value=null,$.value=""}),A(v,()=>{o.value=null,$.value=""}),A(o,k=>{if(!k)return;const[u,T]=k.label.split("_");$.value=T==="next-day"?`${g(s.value).add(1,"day").format(i)} ${u}`:`${s.value} ${u}`}),{selectedDate:s,selectedStartTime:v,selectedEndObj:o,selectedEndDateTime:$,timeSector:f,maxUsageHours:_,minUsageHours:O,generateCrossDay:D,isNowActive:Y,usedTimeSlots:H,startTimeOptions:P,endTimeOptions:L,timeSlots:U,resetStartTime:()=>{v.value="",o.value=null,$.value=""},resetEndTime:()=>{o.value=null,$.value=""},updateUsedTimeSlots:({newUsedTimeSlots:k,ignoreUsedSlots:u=!1})=>{H.value=u?[]:k,I()}}}const oe={class:"w-full"},ie={class:"flex items-center justify-center"},re={class:"m-2"},ue={class:"flex flex-wrap items-center justify-center"},de={class:"m-2 flex flex-wrap"},me={class:"mx-2"},ce={for:"generate-cross-day"},ve={class:"mx-2"},fe={for:"is-now-active"},pe={class:"flex flex-wrap items-center justify-center"},$e={class:"m-2"},ye={for:"time-sector"},Te=["value"],Se={class:"m-2"},he={for:"min-usage-hours"},ge=["value"],be={class:"m-2"},De={for:"max-usage-hours"},Oe=["value"],we={class:"flex flex-wrap items-center justify-center"},_e={class:"m-2"},He={for:"date-picker"},xe={class:"m-2"},Ee={for:"start-time-picker"},Ye=["disabled"],Ue=["value","disabled"],je={class:"m-2"},Me={for:"end-time-picker"},ke=["disabled"],Ne=["value","disabled"],Ce={class:"flex flex-wrap items-center justify-center"},Be={class:"my-2 w-full text-center"},Ae={class:"my-2 w-full text-center"},Ve={class:"mt-8 flex justify-center text-sm text-gray-600"},Ie={class:"mt-2"},M="YYYY-MM-DD",Le=J({name:"DemoTimeSelector",__name:"TimeSelector",setup(S){const n=g(),y=n.subtract(1,"day"),p=n.add(1,"day"),c=b(n.format(M)),m=b(""),a=b(""),{usedTimeSlots:i,selectedEndObj:h,timeSector:r,maxUsageHours:l,minUsageHours:s,generateCrossDay:v,isNowActive:$,startTimeOptions:o,endTimeOptions:f,updateUsedTimeSlots:_,resetStartTime:O,resetEndTime:D}=ne([],{timeSector:30,maxUsageHours:24,minUsageHours:.5,generateCrossDay:!0,isNowActive:!0,externalRefs:{selectedDate:c,selectedStartTime:m,selectedEndDateTime:a},defaultOptions:{startTime:{label:"please-select-start-time",value:""},endTime:{label:"please-select-end-time",value:""}}}),Y=Array.from({length:24},(u,T)=>T+1),H=R(()=>Array.from({length:1/(r.value/60)},(T,e)=>(e+1)*(r.value/60))),U=[15,30,60],I=async()=>(await new Promise(u=>setTimeout(u,500)),[{startTime:"21:00",endTime:"22:30",date:y.format(M)},{startTime:"08:00",endTime:"08:30",date:n.format(M)},{startTime:"23:00",endTime:"23:30",date:n.format(M)},{startTime:"00:00",endTime:"00:50",date:p.format(M)},{startTime:"20:30",endTime:"23:30",date:p.format(M)}]);Q(async()=>{c.value=n.format(M);const u=await I();_({newUsedTimeSlots:u})});const P=()=>{D()},L=()=>{D()},K=()=>{H.value.includes(s.value)||(s.value=H.value[0]),O()},W=()=>{D()},k=()=>{O()};return A([v],()=>{D()}),A([$],()=>{O()}),A([s,l],()=>{D()}),(u,T)=>(E(),x("div",oe,[T[9]||(T[9]=t("h1",{class:"text-center text-lg"},"Time Selector 選擇器",-1)),t("div",ie,[t("h3",re,d(u.$t("used-time-slots")),1),t("ul",null,[(E(!0),x(N,null,C(w(i),e=>(E(),x("li",{key:e.startTime},[t("p",null,d(e.date)+" "+d(e.startTime)+" ~ "+d(e.endTime),1)]))),128))])]),t("div",ue,[t("div",de,[t("div",me,[t("label",ce,d(u.$t("generate-cross-day"))+"：",1),j(t("input",{id:"generate-cross-day","onUpdate:modelValue":T[0]||(T[0]=e=>B(v)?v.value=e:null),type:"checkbox",onChange:W},null,544),[[q,w(v)]])]),t("div",ve,[t("label",fe,d(u.$t("is-now-active"))+"：",1),j(t("input",{id:"is-now-active","onUpdate:modelValue":T[1]||(T[1]=e=>B($)?$.value=e:null),type:"checkbox",onChange:k},null,544),[[q,w($)]])])])]),t("div",pe,[t("div",$e,[t("label",ye,d(u.$t("time-sector"))+"：",1),j(t("select",{id:"time-sector","onUpdate:modelValue":T[2]||(T[2]=e=>B(r)?r.value=e:null),class:"min-w-32",onChange:K},[(E(),x(N,null,C(U,e=>t("option",{key:e,value:e},d(e)+" "+d(u.$t("minutes")),9,Te)),64))],544),[[V,w(r)]])]),t("div",Se,[t("label",he,d(u.$t("min-usage-hours"))+"：",1),j(t("select",{id:"min-usage-hours","onUpdate:modelValue":T[3]||(T[3]=e=>B(s)?s.value=e:null),class:"min-w-32",onChange:P},[(E(!0),x(N,null,C(H.value,e=>(E(),x("option",{key:e,value:e},d(e)+" "+d(u.$t("hours")),9,ge))),128))],544),[[V,w(s)]])]),t("div",be,[t("label",De,d(u.$t("max-usage-hours"))+"：",1),j(t("select",{id:"max-usage-hours","onUpdate:modelValue":T[4]||(T[4]=e=>B(l)?l.value=e:null),class:"min-w-32",onChange:L},[(E(!0),x(N,null,C(w(Y),e=>(E(),x("option",{key:e,value:e},d(e)+" "+d(u.$t("hours")),9,Oe))),128))],544),[[V,w(l)]])])]),t("div",we,[t("div",_e,[t("label",He,d(u.$t("date"))+"：",1),j(t("input",{id:"date-picker","onUpdate:modelValue":T[5]||(T[5]=e=>c.value=e),type:"date"},null,512),[[X,c.value]])]),t("div",xe,[t("label",Ee,d(u.$t("start-time"))+"：",1),j(t("select",{id:"start-time-picker","onUpdate:modelValue":T[6]||(T[6]=e=>m.value=e),disabled:w(o).length===0,class:"min-w-32"},[(E(!0),x(N,null,C(w(o),e=>(E(),x("option",{key:e.value,value:e.value,disabled:e.disabled},d(e.value==="Now"?u.$t("now"):e.value===""?u.$t(e.label):e.label),9,Ue))),128))],8,Ye),[[V,m.value]])]),t("div",je,[t("label",Me,d(u.$t("end-time"))+"：",1),j(t("select",{id:"end-time-picker","onUpdate:modelValue":T[7]||(T[7]=e=>B(h)?h.value=e:null),disabled:w(f).length===0,class:"min-w-32"},[(E(!0),x(N,null,C(w(f),e=>(E(),x("option",{key:e.value,value:e,disabled:e.disabled},d(e.value===""?u.$t(e.label):e.label.includes("next-day")?`${e.label.split("_")[0]} ${u.$t(`${e.label.split("_")[1]}`)}`:e.label),9,Ne))),128))],8,ke),[[V,w(h)]])])]),t("div",Ce,[t("p",Be,d(u.$t("selected-start-dateTime"))+"： "+d(c.value)+" "+d(m.value==="Now"?u.$t("now"):m.value),1),t("p",Ae,d(u.$t("selected-end-dateTime"))+"： "+d(a.value),1)]),t("div",Ve,[t("details",null,[T[8]||(T[8]=t("summary",null,"除錯資訊",-1)),t("div",Ie,[t("p",null,"可用開始時間選項數量: "+d(w(o).length),1),t("p",null,"可用結束時間選項數量: "+d(w(f).length),1),t("p",null,"選中的開始時間: "+d(m.value),1),t("p",null,"選中的結束時間物件: "+d(w(h)?.value),1),t("p",null,"格式化後的結束時間: "+d(a.value),1)])])])]))}});export{Le as default};
